# ebirogue
海老さんのローグライクゲーム

## コードベースの概要
- コードベースは Go 言語で書かれたローグライクゲームです。描画処理には Ebiten ライブラリを使用しています。
- ファイル構成は比較的シンプルで、ゲームループや描画、入力処理、マップ生成、アイテム／敵の管理などが各ファイルに分かれています。

## 主要なファイルと役割
- **`main.go`**
  - エントリポイント。`NewGame` で `Game` 構造体を生成し `ebiten.RunGame` に渡します。
  - ゲーム全体の状態を保持する `GameState` やプレイヤー・敵・アイテムの初期化もここで行っています。
- **`map.go`**
  - マップ生成・部屋の接続・タイルの明るさ処理などを担当します。部屋同士をつなぐ `connectRooms` や、階段生成、ミニマップ更新などもここです。
- **`input.go`**
  - キーボード入力の処理をまとめています。インベントリ操作やアイテム使用、プレイヤー移動の入力判定が実装されています。
- **`move.go`**
  - プレイヤー・敵の移動ロジックや移動に伴う体力・満腹度回復処理を担当します。
- **`draw.go`**
  - マップ・キャラクター・HUD などの描画処理を行います。ミニマップやアイテムウィンドウ等の UI 描画もここにまとまっています。
- **アイテム関連 (`item.go`, `items.go`, `itemeffects.go`)**
  - `items.go` で武器・防具・回復アイテム等の構造体を定義し、`itemeffects.go` に個々の効果関数が実装されています。`item.go` ではアイテムの投げ処理や視認可否の管理を行います。
- **`enemies.go`**
  - 敵キャラクターの構造体定義や生成処理を持ちます。

## 知っておくべきポイント
- **Game/ActionQueue**
  - 行動（攻撃・アイテム使用など）は `ActionQueue` に積まれ、`HandleActionQueue` で順に実行されます。これによりアニメーションやメッセージ表示のタイミングを管理しています。
- **アイテムとインタフェース**
  - `interfaces.go` に `Item`, `Equipable`, `Identifiable` など複数のインタフェースが定義されています。武器・防具などは `Equipable` を実装し、装備時にプレイヤー能力を更新するロジックもここにあります。
- **マップと明るさ管理**
  - `updateTileBrightness` でプレイヤーのいる部屋や隣接タイルのみ明るく表示し、それ以外を暗くしています。探索済みタイルの記録も行われます。

## 次に学習・確認すると良いこと
1. **ゲーム実行方法**
   - `go run .` で実行可能です。ブラウザ版をビルドする場合は `GOOS=js GOARCH=wasm go build -o ebirogue.wasm` を利用します。
2. **Ebiten の基礎**
   - 描画・入力処理の流れを理解するため、Ebiten のドキュメントを参照してください。
3. **アイテム効果の追加**
   - `itemeffects.go` に用意されている関数を参考に、効果処理を増やしてみると良いでしょう。
4. **マップ生成アルゴリズム**
   - `generateRooms` や `connectRooms` の実装を読み、部屋配置や通路生成のロジックを把握すると改良がしやすくなります。

このリポジトリは日本語コメントも多く、ゲームの各要素が分割されたファイルにまとまっています。まずは `main.go` と `Game` 構造体を起点に、プレイヤーの更新処理や描画処理の流れを追ってみると理解しやすいでしょう。コードを読みながら実際にプレイしてみることで、各機能の関連性や改良点も見えてきます。これを参考に開発を進めてみてください.
